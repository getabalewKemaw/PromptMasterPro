# PromptMaster Pro Backend - Complete Setup & Testing Guide

## Prerequisites
- Node.js (v16 or higher)
- PostgreSQL (v12 or higher)
- Postman or Thunder Client (for API testing)
- OpenAI API Key
- Hasab AI API Key (optional)

---

## Step 1: Database Setup

### Option A: Local PostgreSQL Installation

1. Install PostgreSQL on your machine
2. Create a new database:
```sql
CREATE DATABASE promptmasterpro;
```

3. Create a database user (optional):
```sql
CREATE USER promptmaster WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE promptmasterpro TO promptmaster;
```

### Option B: Using Docker

```bash
docker run --name promptmasterpro-db \
  -e POSTGRES_DB=promptmasterpro \
  -e POSTGRES_USER=promptmaster \
  -e POSTGRES_PASSWORD=your_password \
  -p 5432:5432 \
  -d postgres:15
```

### Option C: Cloud Database (Recommended for Production)

Use services like:
- Neon (https://neon.tech) - Free tier available
- Supabase (https://supabase.com) - Free tier available
- Railway (https://railway.app) - Free tier available
- ElephantSQL (https://www.elephantsql.com) - Free tier available

---

## Step 2: Environment Configuration

1. Copy the example environment file:
```bash
cp .env.example .env
```

2. Edit `.env` with your actual values:

```env
PORT=3000
NODE_ENV=development

# Database URL format:
# postgresql://username:password@host:port/database?schema=public

# For local PostgreSQL:
DATABASE_URL="postgresql://promptmaster:your_password@localhost:5432/promptmasterpro?schema=public"

# For cloud database (example with Neon):
# DATABASE_URL="postgresql://user:password@ep-xxx.region.aws.neon.tech/promptmasterpro?sslmode=require"

# API Keys
OPENAI_API_KEY=sk-your-openai-api-key-here
HASAB_API_KEY=your-hasab-api-key-here

# JWT Secret (generate a random string)
JWT_SECRET=your-super-secret-jwt-key-change-this-to-random-string

# CORS Origin (for mobile app)
CORS_ORIGIN=http://localhost:8081
```

---

## Step 3: Install Dependencies

```bash
npm install
```

---

## Step 4: Run Database Migrations

This will create all the necessary tables in your database:

```bash
npx prisma migrate dev --name init
```

If you get an error about the database not existing, make sure:
1. PostgreSQL is running
2. The database exists
3. The DATABASE_URL in .env is correct

---

## Step 5: Seed the Database

This will populate your database with sample templates:

```bash
npm run prisma:seed
```

You should see:
```
üå± Seeding database...
‚úÖ Database seeded successfully!
üìù Created 10 templates
```

---

## Step 6: Generate Prisma Client

```bash
npx prisma generate
```

---

## Step 7: Start the Development Server

```bash
npm run dev
```

You should see:
```
üöÄ Server is running on http://localhost:3000
üìä Health check: http://localhost:3000/health
```

---

## Step 8: Verify Server is Running

Open your browser or use curl:

```bash
curl http://localhost:3000/health
```

Expected response:
```json
{
  "status": "success",
  "message": "PromptMaster Pro API is running",
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

---

## Step 9: Test with Postman

### Import the Collection

1. Open Postman
2. Click "Import"
3. Select `PromptMasterPro.postman_collection.json`
4. The collection will be imported with all endpoints

### Test Flow

1. **Health Check**
   - Run the "Health Check" request
   - Should return 200 OK

2. **Register a User**
   - Run "Register User" in the Authentication folder
   - The token will be automatically saved
   - Should return 201 Created

3. **Login**
   - Run "Login" request
   - Token will be automatically updated
   - Should return 200 OK

4. **Get Profile**
   - Run "Get Profile" request
   - Should return your user data
   - Should return 200 OK

5. **Get All Templates**
   - Run "Get All Templates" request
   - Should return 10 templates
   - Should return 200 OK

6. **Create a Prompt**
   - Run "Create Prompt" request
   - This will call the OpenAI API
   - Should return 201 Created with AI response

7. **Get User Prompts**
   - Run "Get User Prompts" request
   - Should return your created prompts
   - Should return 200 OK

8. **Toggle Favorite**
   - Copy a prompt ID from the previous response
   - Paste it in the "Toggle Favorite" request
   - Run the request
   - Should return 200 OK

9. **Delete Prompt**
   - Use the same prompt ID
   - Run "Delete Prompt" request
   - Should return 200 OK

---

## Step 10: Explore Database with Prisma Studio

```bash
npm run prisma:studio
```

This will open Prisma Studio at http://localhost:5555
You can view and edit your database records here.

---

## Testing Rate Limiting

The API has rate limiting enabled:

- **General API**: 100 requests per 15 minutes
- **Authentication**: 5 requests per 15 minutes (try registering 6 times)
- **AI Generation**: 20 requests per 15 minutes

To test:
1. Try to register 6 times quickly
2. You should get a 429 error on the 6th attempt

---

## Testing Validation

Try these invalid requests to test validation:

### Invalid Email
```json
{
  "name": "Test",
  "email": "invalid-email",
  "password": "123456"
}
```
Should return 400 with validation errors

### Short Password
```json
{
  "name": "Test",
  "email": "test@example.com",
  "password": "123"
}
```
Should return 400 with validation errors

---

## Common Issues & Solutions

### Issue: "Can't reach database server"
**Solution**: 
- Check if PostgreSQL is running
- Verify DATABASE_URL in .env
- Test connection: `psql -U promptmaster -d promptmasterpro`

### Issue: "Invalid API key"
**Solution**:
- Verify OPENAI_API_KEY in .env
- Check if the key is active in your OpenAI dashboard

### Issue: "Port 3000 already in use"
**Solution**:
- Change PORT in .env to another port (e.g., 3001)
- Or kill the process using port 3000

### Issue: "Module not found"
**Solution**:
- Run `npm install` again
- Delete node_modules and run `npm install`

---

## API Endpoints Summary

### Authentication
- POST /api/auth/register - Register new user
- POST /api/auth/login - Login user
- GET /api/auth/profile - Get user profile (requires auth)

### Prompts
- POST /api/prompts - Create prompt (requires auth)
- GET /api/prompts - Get user prompts (requires auth)
- GET /api/prompts/:id - Get prompt by ID (requires auth)
- PATCH /api/prompts/:id/favorite - Toggle favorite (requires auth)
- DELETE /api/prompts/:id - Delete prompt (requires auth)

### Templates
- GET /api/templates - Get all templates
- GET /api/templates/category/:category - Get templates by category
- GET /api/templates/:id - Get template by ID

---

## Next Steps

1. ‚úÖ Backend is complete and tested
2. ‚úÖ All endpoints are working
3. ‚úÖ Database is seeded
4. ‚úÖ Rate limiting is active
5. ‚úÖ Validation is working

You're now ready to:
- Build the mobile app
- Connect the mobile app to this backend
- Deploy to production

---

## Production Deployment Checklist

Before deploying to production:

1. [ ] Change JWT_SECRET to a strong random string
2. [ ] Use a production PostgreSQL database
3. [ ] Set NODE_ENV=production
4. [ ] Update CORS_ORIGIN to your mobile app's domain
5. [ ] Add proper error logging (e.g., Sentry)
6. [ ] Set up database backups
7. [ ] Enable HTTPS
8. [ ] Add monitoring (e.g., PM2, New Relic)
9. [ ] Review and adjust rate limits
10. [ ] Add API documentation hosting

---

## Support

For issues or questions:
- Check the API_DOCUMENTATION.txt file
- Review the Postman collection
- Check the code comments in the controllers

Happy coding! üöÄ
